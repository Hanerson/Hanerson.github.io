<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <title>2048</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #faf8ef;
            font-family: Arial, sans-serif;
        }

        #game-board {
            display: grid;
            grid-template-columns: repeat(4, 100px);
            grid-template-rows: repeat(4, 100px);
            gap: 10px;
            background-color: #bbada0;
            padding: 10px;
            border-radius: 5px;
        }

        .cell {
            background-color: rgba(238, 228, 218, 0.35);
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 36px;
            font-weight: bold;
        }

        #score {
            margin-top: 20px;
            font-size: 24px;
            text-align: center;
        }
    </style>
</head>

<body>
<div id="game-board"></div>
<div id="score">得分: 0</div>
<script>
    const board = document.getElementById('game-board');
    const scoreElement = document.getElementById('score');
    let score = 0;
    let gameGrid = [
        [0, 0, 0, 0],
        [0, 0, 0, 0],
        [0, 0, 0, 0],
        [0, 0, 0, 0]
    ];

    function createCell(value) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        if (value > 0) {
            cell.textContent = value;
            cell.style.backgroundColor = getCellColor(value);
        }
        return cell;
    }

    function getCellColor(value) {
        switch (value) {
            case 2: return '#eee4da';
            case 4: return '#ede0c8';
            case 8: return '#f2b179';
            case 16: return '#f59563';
            case 32: return '#f67c5f';
            case 64: return '#f65e3b';
            case 128: return '#edcf72';
            case 256: return '#edcc61';
            case 512: return '#edc850';
            case 1024: return '#edc53f';
            case 2048: return '#edc22e';
            default: return '#cdc1b4';
        }
    }

    function drawBoard() {
        board.innerHTML = '';
        for (let row = 0; row < 4; row++) {
            for (let col = 0; col < 4; col++) {
                const cell = createCell(gameGrid[row][col]);
                board.appendChild(cell);
            }
        }
        scoreElement.textContent = `得分: ${score}`;
    }

    function addRandomTile() {
        const emptyCells = [];
        for (let row = 0; row < 4; row++) {
            for (let col = 0; col < 4; col++) {
                if (gameGrid[row][col] === 0) {
                    emptyCells.push({ row, col });
                }
            }
        }
        if (emptyCells.length > 0) {
            const randomIndex = Math.floor(Math.random() * emptyCells.length);
            const { row, col } = emptyCells[randomIndex];
            gameGrid[row][col] = Math.random() < 0.9 ? 2 : 4;
        }
    }

    function slideAndMerge(row) {
        const nonZero = row.filter(num => num !== 0);
        const merged = [];
        let i = 0;
        while (i < nonZero.length) {
            if (i + 1 < nonZero.length && nonZero[i] === nonZero[i + 1]) {
                merged.push(nonZero[i] * 2);
                score += nonZero[i] * 2;
                i += 2;
            } else {
                merged.push(nonZero[i]);
                i++;
            }
        }
        while (merged.length < 4) {
            merged.push(0);
        }
        return merged;
    }

    function moveLeft() {
        let hasChanged = false;
        for (let row = 0; row < 4; row++) {
            const oldRow = [...gameGrid[row]];
            gameGrid[row] = slideAndMerge(gameGrid[row]);
            if (JSON.stringify(oldRow) !== JSON.stringify(gameGrid[row])) {
                hasChanged = true;
            }
        }
        if (hasChanged) {
            addRandomTile();
        }
        drawBoard();
    }

    function moveRight() {
        let hasChanged = false;
        for (let row = 0; row < 4; row++) {
            const oldRow = [...gameGrid[row]];
            const reversedRow = gameGrid[row].slice().reverse();
            const merged = slideAndMerge(reversedRow).reverse();
            gameGrid[row] = merged;
            if (JSON.stringify(oldRow) !== JSON.stringify(gameGrid[row])) {
                hasChanged = true;
            }
        }
        if (hasChanged) {
            addRandomTile();
        }
        drawBoard();
    }

    function moveUp() {
        let hasChanged = false;
        for (let col = 0; col < 4; col++) {
            const column = [];
            for (let row = 0; row < 4; row++) {
                column.push(gameGrid[row][col]);
            }
            const oldColumn = [...column];
            const merged = slideAndMerge(column);
            for (let row = 0; row < 4; row++) {
                gameGrid[row][col] = merged[row];
            }
            if (JSON.stringify(oldColumn) !== JSON.stringify(merged)) {
                hasChanged = true;
            }
        }
        if (hasChanged) {
            addRandomTile();
        }
        drawBoard();
    }

    function moveDown() {
        let hasChanged = false;
        for (let col = 0; col < 4; col++) {
            const column = [];
            for (let row = 0; row < 4; row++) {
                column.push(gameGrid[row][col]);
            }
            const oldColumn = [...column];
            const reversedColumn = column.slice().reverse();
            const merged = slideAndMerge(reversedColumn).reverse();
            for (let row = 0; row < 4; row++) {
                gameGrid[row][col] = merged[row];
            }
            if (JSON.stringify(oldColumn) !== JSON.stringify(merged)) {
                hasChanged = true;
            }
        }
        if (hasChanged) {
            addRandomTile();
        }
        drawBoard();
    }

    document.addEventListener('keydown', function (event) {
        switch (event.key) {
            case 'ArrowLeft':
                moveLeft();
                break;
            case 'ArrowRight':
                moveRight();
                break;
            case 'ArrowUp':
                moveUp();
                break;
            case 'ArrowDown':
                moveDown();
                break;
        }
    });

    addRandomTile();
    addRandomTile();
    drawBoard();
</script>
</body>

</html>
